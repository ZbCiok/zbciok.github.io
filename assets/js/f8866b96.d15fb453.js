"use strict";(self.webpackChunkjreact_com_docsaurus_01=self.webpackChunkjreact_com_docsaurus_01||[]).push([[8238],{357:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"streams/kafka-streams/Examples/kafka-streams-getting-started","title":"Kafka Streams Getting Started","description":"Description","source":"@site/docs/streams/kafka-streams/Examples/kafka-streams-getting-started.mdx","sourceDirName":"streams/kafka-streams/Examples","slug":"/streams/kafka-streams/Examples/kafka-streams-getting-started","permalink":"/docs/streams/kafka-streams/Examples/kafka-streams-getting-started","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":100,"frontMatter":{"sidebar_position":100},"sidebar":"tutorialSidebar","previous":{"title":"Examples","permalink":"/docs/kafka-streams/examples"},"next":{"title":"References","permalink":"/docs/streams/kafka-streams/references"}}');var r=a(4848),i=a(8453);const s={sidebar_position:100},o="Kafka Streams Getting Started",c={},l=[{value:"Description",id:"description",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Create the input and output topic",id:"create-the-input-and-output-topic",level:2},{value:"Setup Docker apache/kafka",id:"setup-docker-apachekafka",level:3},{value:"Create topics",id:"create-topics",level:3},{value:"input-topic",id:"input-topic",level:4},{value:"output topic",id:"output-topic",level:4},{value:"Project Structure",id:"project-structure",level:2},{value:"pom.xml",id:"pomxml",level:3},{value:"KafkaStreamsDemo.java",id:"kafkastreamsdemojava",level:3},{value:"Running the example",id:"running-the-example",level:2}];function p(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"kafka-streams-getting-started",children:"Kafka Streams Getting Started"})}),"\n",(0,r.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,r.jsx)("img",{src:"/img/streams/kafka-streams/examples/kafka-streams-getting-started-ex-01.png",alt:"kafka-streams-getting-started-ex-01.png"}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Input Stream - an input kafka topic in which you will get video titles with number of views per video"}),"\n",(0,r.jsx)(n.li,{children:"Consumer / Processor - a kafka streams application which reads the video views data and counts the number of views each video is getting"}),"\n",(0,r.jsx)(n.li,{children:"Processor / Consumer - Kafka streams will write the total video view data into an output topic"}),"\n",(0,r.jsx)(n.li,{children:"The output topic at any point will have the total number of views each of our videos have got."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Maven"}),"\n",(0,r.jsx)(n.li,{children:"JDK 1.8+"}),"\n",(0,r.jsx)(n.li,{children:"Docker / Docker Desktop"}),"\n",(0,r.jsx)(n.li,{children:"Docker apache/kafka:3.9.0"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"create-the-input-and-output-topic",children:"Create the input and output topic"}),"\n",(0,r.jsx)(n.h3,{id:"setup-docker-apachekafka",children:"Setup Docker apache/kafka"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker pull apache/kafka:3.9.0\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker run -p 9092:9092 apache/kafka:3.9.0\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker ps\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'CONTAINER ID   IMAGE                COMMAND                  CREATED        STATUS          PORTS                    NAMES\n8fd96b3b82b5   apache/kafka:3.9.0   "/__cacert_entrypoin\u2026"   44 hours ago   Up 29 seconds   0.0.0.0:9092->9092/tcp   nifty_curie\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Container name (above): ",(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"nifty_curie"})})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker exec -it nifty_curie /bin/bash\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"cd /opt/kafka\n"})}),"\n",(0,r.jsx)(n.h3,{id:"create-topics",children:"Create topics"}),"\n",(0,r.jsx)(n.h4,{id:"input-topic",children:"input-topic"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\nbin/kafka-topics.sh --create --topic input-topic --partitions 1 --replication-factor 1 --bootstrap-server localhost:9092\n"})}),"\n",(0,r.jsx)(n.h4,{id:"output-topic",children:"output topic"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\nbin/kafka-topics.sh --create --topic output-topic --partitions 1 --replication-factor 1 --bootstrap-server localhost:9092\n"})}),"\n",(0,r.jsx)(n.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,r.jsx)(n.h3,{id:"pomxml",children:"pom.xml"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>org.example</groupId>\n    <artifactId>kafka-streams-demo</artifactId>\n    <version>1.0-SNAPSHOT</version>\n\n    <dependencies>\n        \x3c!-- https://mvnrepository.com/artifact/org.apache.kafka/kafka-streams --\x3e\n        <dependency>\n            <groupId>org.apache.kafka</groupId>\n            <artifactId>kafka-streams</artifactId>\n            <version>2.8.0</version>\n        </dependency>\n        \x3c!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-log4j12 --\x3e\n        <dependency>\n            <groupId>org.slf4j</groupId>\n            <artifactId>slf4j-log4j12</artifactId>\n            <version>1.7.30</version>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <version>3.6.1</version>\n                <configuration>\n                    <source>1.8</source>\n                    <target>1.8</target>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-assembly-plugin</artifactId>\n                <executions>\n                    <execution>\n                        <phase>package</phase>\n                        <goals>\n                            <goal>single</goal>\n                        </goals>\n                        <configuration>\n                            <archive>\n                                <manifest>\n                                    <mainClass>KafkaStreamsDemo</mainClass>\n                                </manifest>\n                            </archive>\n                            <descriptorRefs>\n                                <descriptorRef>jar-with-dependencies</descriptorRef>\n                            </descriptorRefs>\n                        </configuration>\n                    </execution>\n                </executions>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n'})}),"\n",(0,r.jsx)(n.h3,{id:"kafkastreamsdemojava",children:"KafkaStreamsDemo.java"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.apache.kafka.common.serialization.Serde;\nimport org.apache.kafka.common.serialization.Serdes;\nimport org.apache.kafka.streams.KafkaStreams;\nimport org.apache.kafka.streams.StreamsBuilder;\nimport org.apache.kafka.streams.StreamsConfig;\nimport org.apache.kafka.streams.kstream.*;\nimport org.apache.log4j.BasicConfigurator;\nimport org.apache.log4j.Level;\nimport org.apache.log4j.Logger;\nimport java.util.Properties;\nimport java.util.concurrent.CountDownLatch;\n\npublic class KafkaStreamsDemo {\n    public static void main(String[] args) {\n        // initialise a default logging mechanism\n        BasicConfigurator.configure();\n        Logger.getRootLogger().setLevel(Level.INFO);\n\n        // setup String, Long Serdes to help with serialising and deserialsing the kafka data\n        final Serde<String> stringSerde = Serdes.String();\n        final Serde<Long> longSerde = Serdes.Long();\n\n        // build the kafka streams topology\n        final StreamsBuilder builder = new StreamsBuilder();\n        KStream<String, String> views = builder.stream(\n                "input-topic",\n                Consumed.with(stringSerde, stringSerde)\n        );\n        KTable<String, Long> totalViews = views\n                .mapValues(v -> Long.parseLong(v))\n                .groupByKey(Grouped.with(stringSerde, longSerde))\n                .reduce(Long::sum);\n        totalViews.toStream().to("output-topic", Produced.with(stringSerde, longSerde));\n\n        // create a KafkaStreams object\n        final Properties props = new Properties();\n        props.putIfAbsent(StreamsConfig.APPLICATION_ID_CONFIG, "streams-totalviews");\n        props.putIfAbsent(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");\n        final KafkaStreams streams = new KafkaStreams(builder.build(), props);\n\n        // starts the kafka streams application\n        final CountDownLatch latch = new CountDownLatch(1);\n        try {\n            streams.start();\n            latch.await();\n        } catch (final Throwable e) {\n            System.exit(1);\n        }\n        Runtime.getRuntime().addShutdownHook(new Thread("streams-totalviews") {\n            @Override\n            public void run() {\n                streams.close();\n                latch.countDown();\n            }\n        });\n        System.exit(0);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"running-the-example",children:"Running the example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"mvn clean package\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"java -jar target/kafka-streams-demo-1.0-SNAPSHOT-jar-with-dependencies.jar\n"})}),"\n",(0,r.jsx)(n.p,{children:"In a second terminal, start a kafka producer using the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'bin/kafka-console-producer.sh --bootstrap-server localhost:9092 \\\n    --topic input-topic \\\n    --property key.separator=":" \\\n    --property parse.key=true\n'})}),"\n",(0,r.jsx)(n.p,{children:"In a third terminal, start a kafka consumer using the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 \\\n    --topic output-topic \\\n    --property print.key=true \\\n    --property key.separator="-" \\\n    --property key.deserializer=org.apache.kafka.common.serialization.StringDeserializer \\\n    --property value.deserializer=org.apache.kafka.common.serialization.LongDeserializer\n'})}),"\n",(0,r.jsx)(n.p,{children:"In the Producer terminal send the following:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Video1:5\nVideo2:10\nVideo1:4\nVideo1:0\nVideo2:7\nVideo3:12\nVideo1:7\n"})}),"\n",(0,r.jsx)(n.p,{children:"In the Consumer terminal you will get the following output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Video2-17\nVideo3-12\nVideo1-16\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:["Based on: ",(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"https://adityasridhar.com/posts/how-to-get-started-with-kafka-streams",children:"https://adityasridhar.com/posts/how-to-get-started-with-kafka-streams"})})}),"_"]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>o});var t=a(6540);const r={},i=t.createContext(r);function s(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);