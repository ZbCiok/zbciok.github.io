"use strict";(self.webpackChunkjreact_com_docsaurus_01=self.webpackChunkjreact_com_docsaurus_01||[]).push([[2805],{560:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"auxiliary-software/kerberos","title":"Kerberos","description":"https://web.mit.edu/kerberos/","source":"@site/docs/auxiliary-software/kerberos.mdx","sourceDirName":"auxiliary-software","slug":"/auxiliary-software/kerberos","permalink":"/docs/auxiliary-software/kerberos","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":550,"frontMatter":{"sidebar_position":550},"sidebar":"tutorialSidebar","previous":{"title":"Jupyter / Anaconda","permalink":"/docs/auxiliary-software/jupyter-anaconda"},"next":{"title":"LocalStack","permalink":"/docs/auxiliary-software/localstack"}}');var i=s(4848),t=s(8453);const a={sidebar_position:550},l="Kerberos",c={},o=[{value:"SSO (single sign-on):",id:"sso-single-sign-on",level:4},{value:"Kerberos provides SSO capabilities tailored for authentication across networked applications and services.",id:"kerberos-provides-sso-capabilities-tailored-for-authentication-across-networked-applications-and-services",level:4},{value:"Kerberos",id:"kerberos-1",level:2},{value:"Components of a Kerberos",id:"components-of-a-kerberos",level:3},{value:"Setup Kerberos on a local Ubuntu machine",id:"setup-kerberos-on-a-local-ubuntu-machine",level:2},{value:"1. Install Kerberos Packages",id:"1-install-kerberos-packages",level:3},{value:"2. Configure Kerberos Realms",id:"2-configure-kerberos-realms",level:3},{value:"3. Create the Kerberos Database",id:"3-create-the-kerberos-database",level:3},{value:"4. Create a Keytab File",id:"4-create-a-keytab-file",level:3},{value:"Use the <em><strong>kadmin</strong></em>",id:"use-the-kadmin",level:4},{value:"Output:",id:"output",level:4},{value:"5. Modify Access Controls",id:"5-modify-access-controls",level:3},{value:"6. Start and Enable Kerberos Services",id:"6-start-and-enable-kerberos-services",level:3},{value:"7. Test",id:"7-test",level:3},{value:"Ticket Management",id:"ticket-management",level:2},{value:"Selected Commands and Utils",id:"selected-commands-and-utils",level:2},{value:"kdb5_util",id:"kdb5_util",level:3},{value:"ktutil",id:"ktutil",level:3},{value:"keytab",id:"keytab",level:3},{value:"Example:",id:"example",level:4},{value:"klist",id:"klist",level:3},{value:"Adding to Database or Modifying Principals",id:"adding-to-database-or-modifying-principals",level:3},{value:"Adding Principals to Keytabs",id:"adding-principals-to-keytabs",level:3},{value:"Delete a principal from a keytab",id:"delete-a-principal-from-a-keytab",level:3},{value:"ktremove",id:"ktremove",level:4},{value:"Output:",id:"output-1",level:4},{value:"kinit",id:"kinit",level:3},{value:"enctypes",id:"enctypes",level:3},{value:"destroy",id:"destroy",level:3},{value:"krb5-config --all",id:"krb5-config---all",level:3},{value:"Kerberos Uninstall from Ubuntu",id:"kerberos-uninstall-from-ubuntu",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"kerberos",children:"Kerberos"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://web.mit.edu/kerberos/",children:"https://web.mit.edu/kerberos/"})})}),(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(n.h4,{id:"sso-single-sign-on",children:"SSO (single sign-on):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Less time spent managing credentials with a single sign-in."}),"\n",(0,i.jsx)(n.li,{children:"Only one master password instead of multiple credentials vulnerable to password attacks."}),"\n",(0,i.jsx)(n.li,{children:"Easy access to apps needed for work."}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"kerberos-provides-sso-capabilities-tailored-for-authentication-across-networked-applications-and-services",children:"Kerberos provides SSO capabilities tailored for authentication across networked applications and services."}),"\n",(0,i.jsx)(n.h2,{id:"kerberos-1",children:"Kerberos"}),"\n",(0,i.jsx)("img",{src:"/img/auxiliary-software/kerberos/kerberos-02.jpg",width:"800 px",alt:"kerberos-02.jpg"}),"\n","\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"In a Kerberos system, once you log in, you get a special ticket that lets you go into different places without entering your password each time."})}),"\n",(0,i.jsx)(n.h3,{id:"components-of-a-kerberos",children:"Components of a Kerberos"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Kerberos Principal"}),":",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.strong,{children:"A Kerberos principal is a unique identity to which Kerberos can assign tickets."})," Principals can have an arbitrary number of components. Each component is separated by a component separator, generally ",(0,i.jsx)(n.strong,{children:"/"}),". The last component is the realm, separated from the rest of the principal by the realm separator, generally @. ",(0,i.jsx)(n.strong,{children:"If there is no realm component in the principal, then it will be assumed that the principal is in the default realm for the context in which it is being used."})]}),"\n",(0,i.jsxs)(n.p,{children:["Traditionally, a principal is divided into three parts: the ",(0,i.jsx)(n.strong,{children:"primary"}),", the ",(0,i.jsx)(n.strong,{children:"instance"}),", and the ",(0,i.jsx)(n.strong,{children:"realm"}),". The format of a typical Kerberos V5 principal is ",(0,i.jsx)(n.strong,{children:"primary/instance@REALM"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.strong,{children:"primary"})," is the first part of the principal. In the case of a user, it's the same as your username. For a host, the primary is the word host."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.strong,{children:"instance"})," is an optional string that qualifies the primary. The instance is separated from the primary by a slash (/). In the case of a user, the instance is usually null, but a user might also have an additional principal, with an instance called admin, which he/she uses to administrate a database. The principal ",(0,i.jsx)(n.code,{children:"jennifer@ATHENA.MIT.EDU"})," is completely separate from the principal jennifer/admin@ATHENA.MIT.EDU, with a separate password, and separate permissions. In the case of a host, the instance is the fully qualified hostname, e.g., daffodil.mit.edu."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.strong,{children:"realm"})," is your Kerberos realm. In most cases, your Kerberos realm is your domain name, in upper-case letters. For example, the machine daffodil.example.com would be in the realm EXAMPLE.COM."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"User and Service Principal"})," names:",(0,i.jsx)("br",{}),"\nIn Kerberos, user and service principal names follow the format of ",(0,i.jsx)(n.strong,{children:"username@REALM"})," or ",(0,i.jsx)(n.strong,{children:"service/instance@REALM"}),", where REALM is the Kerberos realm or domain name, and username or service/instance is the user or service identifier."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"User Principal Name (UPN)"}),": Kerberos uses UPNs to identify users, which are in the format username@REALM."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service Principal Name (SPN)"}),": SPNs identify services and follow the format service/instance@REALM."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Realm"}),": The realm is the domain or Kerberos domain that the user or service belongs to."]}),"\n",(0,i.jsxs)(n.li,{children:["Examples:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["User: ",(0,i.jsx)(n.code,{children:"jdoe@SALES.WIDGET.COM"})]}),"\n",(0,i.jsxs)(n.li,{children:["Service: ",(0,i.jsx)(n.code,{children:"WAS/test.austin.ibm.com@AUSTIN.IBM.COM"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key Distribution Center"})," (",(0,i.jsx)(n.strong,{children:"KDC"}),"): The KDC acts as a trusted third party, managing authentication services using symmetric-key cryptography. All network members, including clients and servers, are registered with the KDC, which securely maintains their secret keys."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Ticket"}),": A ticket serves as an encrypted message providing evidence that a subject is authorized to access a specific object. Also known as a service ticket (ST), users request tickets to access files or other objects. Tickets have set lifetimes and usage parameters, requiring renewal or reissuing once expired.\nYour Kerberos credentials, or \u201ctickets\u201d, are a set of electronic information that can be used to verify your identity. Your Kerberos tickets may be stored in a file, or they may exist only in memory."]}),"\n",(0,i.jsxs)(n.p,{children:["The first ticket you obtain is a ",(0,i.jsx)(n.strong,{children:"ticket-granting ticket (TGT)"}),", which permits you to obtain additional tickets. These additional tickets give you permission for specific services. The requesting and granting of these additional tickets happens transparently."]}),"\n",(0,i.jsx)(n.p,{children:"A good analogy for the ticket-granting ticket is a three-day ski pass that is good at four different resorts. You show the pass at whichever resort you decide to go to (until it expires), and you receive a lift ticket for that resort. Once you have the lift ticket, you can ski all you want at that resort. If you go to another resort the next day, you once again show your pass, and you get an additional lift ticket for the new resort. The difference is that the Kerberos V5 programs notice that you have the weekend ski pass, and get the lift ticket for you, so you don't have to perform the transactions yourself."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Base Master Key Name"}),(0,i.jsx)("br",{}),"\nThe master key is the foundation of Kerberos security, used to encrypt and decrypt the KDC database, which stores the keys of all principals in the realm."]}),"\n",(0,i.jsx)(n.p,{children:'In Kerberos, the "base master key name" or "master key principal" is typically formatted as K/M@REALM, where K/M represents the KDC (Key Distribution Center) and @REALM specifies the Kerberos realm.'}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"To reset the Kerberos principal database (typically located in /var/lib/krb5kdc/principal), you'll need to use the kdb5_util tool to destroy and recreate the database."})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Ticket-Granting Ticket"})," (",(0,i.jsx)(n.strong,{children:"TGT"}),"): The TGT offers proof that a subject has authenticated through the KDC and is authorized to request tickets for accessing various objects. Encrypted and containing a symmetric key, expiration time, and user\u2019s IP address, the TGT is presented when requesting tickets for object access."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"krbtgt"}),': KRBTGT stands for "Kerberos Ticket-Granting Ticket". The ',(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"krbtgt"})})," account is used by the KDC to encrypt and sign Kerberos tickets, specifically Ticket Granting Tickets (TGTs), which are used for initial authentication."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Kerberos Authentication Server"}),": The authentication server encompasses the functions of the KDC, housing both a ticket-granting service (TGS) and an authentication service (AS)."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Ticket Granting Service"})," (",(0,i.jsx)(n.strong,{children:"TGS"}),"):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"To start the authentication process, the client sends a request to the authentication server for a specific user principal. This request is sent without encryption. No secure information is included in the request, so it is not necessary to use encryption."}),"\n",(0,i.jsx)(n.li,{children:"When the request is received by the authentication service, the principal name of the user is looked up in the KDC database. If a principal matches the entry in the database, the authentication service obtains the private key for that principal. The authentication service then generates a session key to be used by the client and the ticket-granting service (call it Session key 1) and a ticket for the ticket-granting service (Ticket 1). This ticket is also known as the ticket-granting ticket (TGT). Both the session key and the ticket are encrypted by using the user's private key, and the information is sent back to the client."}),"\n",(0,i.jsx)(n.li,{children:"The client uses this information to decrypt Session Key 1 and Ticket 1, by using the private key for the user principal. Because the private key should only be known by the user and the KDC database, the information in the packet should be safe. The client stores the information in the credentials cache."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Kerberos Realm"}),": In Kerberos terminology, a realm is a logically controlled area, like a domain or network, governed by Kerberos. Principals within the realm can request tickets from Kerberos, and the system can issue tickets to these principals within the defined realm."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Keytab name"}),": FILE:/etc/krb5.keytab. This is the system keytab file, which is the default file for all keys that might be needed for services on this host, and we can list them with ",(0,i.jsx)(n.strong,{children:"klist -k"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"setup-kerberos-on-a-local-ubuntu-machine",children:"Setup Kerberos on a local Ubuntu machine"}),"\n",(0,i.jsx)(n.h3,{id:"1-install-kerberos-packages",children:"1. Install Kerberos Packages"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sudo apt update\nsudo apt install krb5-kdc krb5-admin-server krb5-user -y\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-configure-kerberos-realms",children:"2. Configure Kerberos Realms"}),"\n",(0,i.jsxs)(n.p,{children:["Edit the Kerberos configuration file ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"/etc/krb5.conf"})})," to define the realms and the servers that will be used for authentication:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sudo nano /etc/krb5.conf\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Under the ",(0,i.jsx)(n.strong,{children:"[realms]"})," section, specify your domain:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[realms]\n YOURDOMAIN.COM = {\n  kdc = your.server.com\n  admin_server = your.server.com\n }\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Replace YOURDOMAIN.COM with your desired domain name (e.g., EXAMPLE.COM) and your.server.com with the hostname of your Kerberos server (or localhost if running locally). ",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.strong,{children:"In our case:"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[realms]\n JREACT.EXAMPLE.COM = {\n  kdc = localhost\n  admin_server = localhost\n }\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"This package contains the administrative tools required to run the Kerberos master server."}),"\n",(0,i.jsx)(n.li,{children:'Installing this package does not automatically set up a Kerberos realm.  This can be done later by running the "krb5_newrealm" command'}),"\n",(0,i.jsxs)(n.li,{children:["Please also read the ",(0,i.jsx)(n.code,{children:"/usr/share/doc/krb5-kdc/README.KDC"})," file and the administration guide found in the krb5-doc package"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"3-create-the-kerberos-database",children:"3. Create the Kerberos Database"}),"\n",(0,i.jsx)(n.p,{children:"Initialize the Kerberos database with the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sudo krb5_newrealm\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"krb5_newrealm\nThis script should be run on the master KDC/admin server to initialize\na Kerberos realm.  It will ask you to type in a master key password.\nThis password will be used to generate a key that is stored in\n/etc/krb5kdc/stash.  You should try to remember this password, but it\nis much more important that it be a strong password than that it be\nremembered.  However, if you lose the password and /etc/krb5kdc/stash,\nyou cannot decrypt your Kerberos database.\nLoading random data\nInitializing database '/var/lib/krb5kdc/principal' for realm 'JREACT.EXAMPLE.COM',\nmaster key name 'K/M@JREACT.EXAMPLE.COM'\nYou will be prompted for the database Master Password.\nIt is important that you NOT FORGET this password.\nEnter KDC database master key:\n"})}),"\n",(0,i.jsx)(n.p,{children:"Enter a secure password when prompted; this will be the master password for the Kerberos database."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:(0,i.jsxs)(n.strong,{children:["Initializing database '/var/lib/krb5kdc/principal' for realm 'JREACT.EXAMPLE.COM', ",(0,i.jsx)("br",{}),"\nmaster key name 'K/M@JREACT.EXAMPLE.COM'"]})})}),"\n",(0,i.jsx)(n.h3,{id:"4-create-a-keytab-file",children:"4. Create a Keytab File"}),"\n",(0,i.jsxs)(n.p,{children:["A keytab (short for \u201ckey table\u201d) stores long-term keys for one or more principals.",(0,i.jsx)("br",{}),"\nA keytab can be displayed using the ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"klist"})})," command with the ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"-k"})})," option.",(0,i.jsx)("br",{}),"\nKeytabs can be created or appended to by extracting keys from the KDC database using the ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"kadmin"})})," ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"ktadd"})})," command. Keytabs can be manipulated using the ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"ktutil"})})," and ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"k5srvutil"})})," commands."]}),"\n",(0,i.jsxs)(n.h4,{id:"use-the-kadmin",children:["Use the ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"kadmin"})})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"kadmin.local\nkadmin.local: ktadd -k /etc/krb5/admin.keytab -norandkey admin/admin@JREACT.EXAMPLE.COM\nkadmin.local: exit\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"kinit -k -t  /etc/krb5/admin.keytab admin/admin@JREACT.EXAMPLE.COM\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"klist\n"})}),"\n",(0,i.jsx)(n.h4,{id:"output",children:"Output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Ticket cache: FILE:/tmp/krb5cc_0\nDefault principal: admin/admin@JREACT.EXAMPLE.COM\n\nValid starting       Expires              Service principal\n04/10/2025 10:23:20  04/10/2025 20:23:20  krbtgt/JREACT.EXAMPLE.COM@JREACT.EXAMPLE.COM\nrenew until 04/11/2025 10:23:19\n"})}),"\n",(0,i.jsxs)(n.p,{children:["see: ",(0,i.jsx)(n.a,{href:"https://web.mit.edu/kerberos/krb5-1.5/krb5-1.5.4/doc/krb5-user/Viewing-Your-Tickets-with-klist.html",children:(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"Viewing Your Tickets with klist"})})})]}),"\n",(0,i.jsx)(n.h3,{id:"5-modify-access-controls",children:"5. Modify Access Controls"}),"\n",(0,i.jsxs)(n.p,{children:["To allow your admin principal to manage the Kerberos database, edit ",(0,i.jsx)(n.code,{children:"/etc/krb5kdc/kadm5.acl"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sudo nano /etc/krb5kdc/kadm5.acl\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Add the following line, replacing ",(0,i.jsx)(n.strong,{children:"youradminusername"})," with your actual admin username:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"*/admin@JREACT.EXAMPLE.COM    *\n"})}),"\n",(0,i.jsx)(n.h3,{id:"6-start-and-enable-kerberos-services",children:"6. Start and Enable Kerberos Services"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sudo systemctl enable krb5-kdc krb5-admin-server\nsudo systemctl start krb5-kdc krb5-admin-server\n"})}),"\n",(0,i.jsx)(n.h3,{id:"7-test",children:"7. Test"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"klist\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Ticket cache: FILE:/tmp/krb5cc_0\nDefault principal: admin/admin@JREACT.EXAMPLE.COM\n\nValid starting       Expires              Service principal\n04/10/2025 10:23:20  04/10/2025 20:23:20  krbtgt/JREACT.EXAMPLE.COM@JREACT.EXAMPLE.COM\n\trenew until 04/11/2025 10:23:19\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"ticket-management",children:"Ticket Management"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://web.mit.edu/kerberos/krb5-1.12/doc/user/tkt_mgmt.html",children:"https://web.mit.edu/kerberos/krb5-1.12/doc/user/tkt_mgmt.html"})})})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"selected-commands-and-utils",children:"Selected Commands and Utils"}),"\n",(0,i.jsx)(n.h3,{id:"kdb5_util",children:"kdb5_util"}),"\n",(0,i.jsx)(n.p,{children:"kdb5_util is a Kerberos utility used for managing the KDC database, allowing tasks like creating, destroying, dumping, and loading databases, as well as managing the Kerberos master key."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Functions and Commands:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Creating a Database"}),": Use the ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"kdb5_util create"})})," command to initialize a new KDC database."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Creating a Stash File"}),": Use ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"kdb5_util create -s"})})," to create a stash file, which stores the master key password securely, preventing the need to enter it every time the KDC starts."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Destroying a Database"}),": Use ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"kdb5_util destroy"})})," to delete the KDC database."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dumping and Loading Databases"}),": Use ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"kdb5_util dump"})})," to export the database to a file and kdb5_util load to import it."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Stashing and Unstashing the Master Key"}),": Use ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"kdb5_util stash"})})," to create or update the master key stash file, and kdb5_util unstash to remove it."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Master Key Rollover"}),": Use ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"kdb5_util use_mkey"})})," to start using a new master key version and kdb5_util update_princ_encryption to re-encrypt all keys in the new master key."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Purging Old Master Keys"}),": Use ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"kdb5_util purge_mkeys"})})," to clean up old master keys."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"ktutil",children:"ktutil"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://web.mit.edu/kerberos/krb5-1.12/doc/admin/admin_commands/ktutil.html",children:"https://web.mit.edu/kerberos/krb5-1.12/doc/admin/admin_commands/ktutil.html"})})}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),"\nThe ktutil command invokes a command interface from which an administrator can read, write, or edit entries in a keytab. (Kerberos V4 srvtab files are no longer supported.)"]}),"\n",(0,i.jsx)(n.h3,{id:"keytab",children:"keytab"}),"\n",(0,i.jsx)(n.p,{children:"In Kerberos, a keytab file is a file containing encrypted credentials (keys) for specific Kerberos principals, enabling systems to authenticate without requiring password input, often used for service-to-service or automated authentication."}),"\n",(0,i.jsx)(n.h4,{id:"example",children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\nktutil:  add_entry -password -p datanode/localhost@JREACT.EXAMPLE.COM -k 1 -e arcfour-hmac-md5\nktutil:  add_entry -password -p datanode/localhost@JREACT.EXAMPLE.COM -k 1 -e arcfour-hmac\nktutil:  add_entry -password -p datanode/localhost@JREACT.EXAMPLE.COM -k 1 -e arcfour-hmac-exp\nktutil:  write_kt /etc/krb5kdc/kadm5.keytab\nkinit -k -t /etc/krb5kdc/kadm5.keytab datanode/localhost@JREACT.EXAMPLE.COM\nkadmin.local: list_principals\nklist  -kte /etc/krb5kdc/kadm5.keytab\n"})}),"\n",(0,i.jsx)(n.p,{children:"A keytab file is a file that stores long-term keys for one or more Kerberos principals."}),"\n",(0,i.jsx)(n.p,{children:"It allows Kerberos clients (services or applications) to authenticate to a Kerberos Key Distribution Center (KDC) without needing to interactively enter a password"}),"\n",(0,i.jsx)(n.p,{children:"Each entry in a keytab file typically contains:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A Kerberos principal name (e.g., a service account or user account)."}),"\n",(0,i.jsx)(n.li,{children:"An encrypted key derived from the principal's password."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"klist",children:"klist"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://web.mit.edu/kerberos/krb5-1.5/krb5-1.5.4/doc/krb5-user/Viewing-Your-Tickets-with-klist.html",children:(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"Viewing Your Tickets with klist"})})})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"klist"})})," lists the Kerberos principal and Kerberos tickets held in a credentials cache, or the keys held in a keytab file.",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"klist"})})," shows the validity of your Kerberos ticket and when it will expire along with ticket cache and principal.\n",(0,i.jsx)(n.strong,{children:"When you first obtain tickets, you will have only the ticket-granting ticket."})," The listing would look like this:"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Tickets in cache:"}),(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"klist\nTicket cache: /tmp/krb5cc_ttypa\nDefault principal: jennifer@ATHENA.MIT.EDU\n\nValid starting     Expires            Service principal\n06/07/04 19:49:21  06/08/04 05:49:19  krbtgt/ATHENA.MIT.EDU@ATHENA.MIT.EDU\n"})}),"\n",(0,i.jsx)(n.p,{children:"If jennifer connected to the machine daffodil.mit.edu, and then typed klist again, she would have gotten the following result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"klist\nTicket cache: /tmp/krb5cc_ttypa\nDefault principal: jennifer@ATHENA.MIT.EDU\n\nValid starting     Expires            Service principal\n06/07/04 19:49:21  06/08/04 05:49:19  krbtgt/ATHENA.MIT.EDU@ATHENA.MIT.EDU\n06/07/04 20:22:30  06/08/04 05:49:19  host/daffodil.mit.edu@ATHENA.MIT.EDU\n"})}),"\n",(0,i.jsx)(n.p,{children:"Suppose your Kerberos tickets allow you to log into a host in another domain, such as trillium.example.com, which is also in another Kerberos realm, EXAMPLE.COM. If you telnet to this host, you will receive a ticket-granting ticket for the realm EXAMPLE.COM, plus the new host ticket for trillium.example.com. klist will now show:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"klist\nTicket cache: /tmp/krb5cc_ttypa\nDefault principal: jennifer@ATHENA.MIT.EDU\n\nValid starting     Expires            Service principal\n06/07/04 19:49:21  06/08/04 05:49:19  krbtgt/ATHENA.MIT.EDU@ATHENA.MIT.EDU\n06/07/04 20:22:30  06/08/04 05:49:19  host/daffodil.mit.edu@ATHENA.MIT.EDU\n06/07/04 20:24:18  06/08/04 05:49:19  krbtgt/EXAMPLE.COM@ATHENA.MIT.EDU\n06/07/04 20:24:18  06/08/04 05:49:19  host/trillium.example.com@ATHENA.MIT.EDU\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Tickets in keytab file:"}),(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# Example:\nklist  -kte /etc/krb5/admin.keytab\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"KVNO Timestamp           Principal\n---- ------------------- ------------------------------------------------------\n   1 04/10/2025 18:03:59 admin/admin@JREACT.EXAMPLE.COM (aes256-cts-hmac-sha1-96)\n   1 04/10/2025 18:03:59 admin/admin@JREACT.EXAMPLE.COM (aes128-cts-hmac-sha1-96)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"adding-to-database-or-modifying-principals",children:"Adding to Database or Modifying Principals"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://web.mit.edu/kerberos/krb5-1.5/krb5-1.5.4/doc/krb5-admin/Adding-or-Modifying-Principals.html",children:"https://web.mit.edu/kerberos/krb5-1.5/krb5-1.5.4/doc/krb5-admin/Adding-or-Modifying-Principals.html"})})})," ",(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),"\nTo add a principal to the database, use the kadmin add_principal command, which requires the \u201cadd\u201d administrative privilege."]}),"\n",(0,i.jsx)(n.h3,{id:"adding-principals-to-keytabs",children:"Adding Principals to Keytabs"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://web.mit.edu/kerberos/krb5-1.4/krb5-1.4.4/doc/krb5-admin/Adding-Principals-to-Keytabs.html",children:"https://web.mit.edu/kerberos/krb5-1.4/krb5-1.4.4/doc/krb5-admin/Adding-Principals-to-Keytabs.html"})})}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),"\nTo generate a keytab, or to add a principal to an existing keytab, use the ktadd command from kadmin."]}),"\n",(0,i.jsx)(n.h3,{id:"delete-a-principal-from-a-keytab",children:"Delete a principal from a keytab"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://web.mit.edu/kerberos//krb5-1.19/doc/admin/enctypes.html",children:"https://web.mit.edu/kerberos//krb5-1.19/doc/admin/enctypes.html"})})})}),"\n",(0,i.jsx)(n.h4,{id:"ktremove",children:"ktremove"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"q - run in quiet mode."}),"\n",(0,i.jsx)(n.li,{children:"all - remove all entries for the specified principal"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"klist  -kte /etc/krb5kdc/kadm5.keytab\nKeytab name: FILE:/etc/krb5kdc/kadm5.keytab\nKVNO Timestamp           Principal\n---- ------------------- ------------------------------------------------------\n   2 04/11/2025 11:35:11 hdfs/localhost@JREACT.EXAMPLE.COM (aes256-cts-hmac-sha1-96)\n   2 04/11/2025 11:35:11 hdfs/localhost@JREACT.EXAMPLE.COM (aes128-cts-hmac-sha1-96)\n   2 04/11/2025 11:36:02 host/localhost@JREACT.EXAMPLE.COM (aes256-cts-hmac-sha1-96)\n   2 04/11/2025 11:36:02 host/localhost@JREACT.EXAMPLE.COM (aes128-cts-hmac-sha1-96)\n   2 04/11/2025 11:36:42 hbase/localhost@JREACT.EXAMPLE.COM (aes256-cts-hmac-sha1-96)\n   2 04/11/2025 11:36:42 hbase/localhost@JREACT.EXAMPLE.COM (aes128-cts-hmac-sha1-96)\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\nkadmin.local:  ktremove -k /etc/krb5kdc/kadm5.keytab -q hdfs/localhost@JREACT.EXAMPLE.COM # all\n"})}),"\n",(0,i.jsx)(n.h4,{id:"output-1",children:"Output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"klist  -kte /etc/krb5kdc/kadm5.keytab\nKeytab name: FILE:/etc/krb5kdc/kadm5.keytab\nKVNO Timestamp           Principal\n---- ------------------- ------------------------------------------------------\n   2 04/11/2025 11:36:02 host/localhost@JREACT.EXAMPLE.COM (aes256-cts-hmac-sha1-96)\n   2 04/11/2025 11:36:02 host/localhost@JREACT.EXAMPLE.COM (aes128-cts-hmac-sha1-96)\n   2 04/11/2025 11:36:42 hbase/localhost@JREACT.EXAMPLE.COM (aes256-cts-hmac-sha1-96)\n   2 04/11/2025 11:36:42 hbase/localhost@JREACT.EXAMPLE.COM (aes128-cts-hmac-sha1-96)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"kinit",children:"kinit"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://web.mit.edu/kerberos/krb5-1.12/doc/user/user_commands/kinit.html",children:"https://web.mit.edu/kerberos/krb5-1.12/doc/user/user_commands/kinit.html"})})}),(0,i.jsx)("br",{})," ",(0,i.jsx)("br",{}),"\nIf you do not have a ticket or is expired, you can get it using the kinit command. Kinit will get and cache the ticket for a principal."]}),"\n",(0,i.jsx)(n.h3,{id:"enctypes",children:"enctypes"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://web.mit.edu/kerberos/krb5-1.5/krb5-1.5.4/doc/krb5-admin/Supported-Encryption-Types.html#Supported-Encryption-Types",children:"https://web.mit.edu/kerberos/krb5-1.5/krb5-1.5.4/doc/krb5-admin/Supported-Encryption-Types.html#Supported-Encryption-Types"})})}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://web.mit.edu/kerberos//krb5-1.19/doc/admin/enctypes.html",children:"https://web.mit.edu/kerberos//krb5-1.19/doc/admin/enctypes.html"})})})," ",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(n.p,{children:"Any tag in the configuration files which requires a list of encryption types can be set to some combination of the following strings."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"des-cbc-crc\n    DES cbc mode with CRC-32\ndes-cbc-md4\n    DES cbc mode with RSA-MD4\ndes-cbc-md5\n    DES cbc mode with RSA-MD5\ndes3-cbc-sha1\ndes3-hmac-sha1\ndes3-cbc-sha1-kd\n    triple DES cbc mode with HMAC/sha1\ndes-hmac-sha1\n    DES with HMAC/sha1\naes256-cts-hmac-sha1-96\naes256-cts\n    AES-256 CTS mode with 96-bit SHA-1 HMAC\naes128-cts-hmac-sha1-96\naes128-cts\n    AES-128 CTS mode with 96-bit SHA-1 HMAC\narcfour-hmac\nrc4-hmac\narcfour-hmac-md5\n    RC4 with HMAC/MD5\narcfour-hmac-exp\nrc4-hmac-exp\narcfour-hmac-md5-exp\n    exportable RC4 with HMAC/MD5\n"})}),"\n",(0,i.jsx)(n.h3,{id:"destroy",children:"destroy"}),"\n",(0,i.jsx)(n.p,{children:"When you are logging out of the system or switching to some other user and want to destroy your active Kerberos ticket by deleting the credential cache, use kdestoy."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"kdestroy\n"})}),"\n",(0,i.jsx)(n.h3,{id:"krb5-config---all",children:"krb5-config --all"}),"\n",(0,i.jsx)(n.p,{children:"In order to get the details on installed Kerberos libraries, use krb5-config command."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"krb5-config --all\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"kerberos-uninstall-from-ubuntu",children:"Kerberos Uninstall from Ubuntu"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check which Kerberos packages are installed:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"dpkg -l | grep krb5\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Uninstall the Kerberos packages:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sudo apt remove --purge krb5-user krb5-config libkrb5-3 libkrb5support0\n"})}),"\n",(0,i.jsx)(n.p,{children:"Adjust based on the actual packages installed."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Clean up residual config files and dependencies:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sudo apt autoremove --purge\nsudo apt clean\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Optional: Delete Kerberos config files manually (if still present):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sudo rm -rf /etc/krb5.conf /etc/krb5.keytab /etc/krb5kdc /var/lib/krb5kdc\n"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);