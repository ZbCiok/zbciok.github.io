"use strict";(self.webpackChunkjreact_com_docsaurus_01=self.webpackChunkjreact_com_docsaurus_01||[]).push([[9941],{7935:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"aws/streaming/kinesis/examples/spring-with-aws-kinesis","title":"Spring Kinesis Producer","description":"https://github.com/awslabs/amazon-kinesis-producer?tab=readme-ov-file","source":"@site/docs/aws/streaming/kinesis/examples/spring-with-aws-kinesis.mdx","sourceDirName":"aws/streaming/kinesis/examples","slug":"/aws/streaming/kinesis/examples/spring-with-aws-kinesis","permalink":"/docs/aws/streaming/kinesis/examples/spring-with-aws-kinesis","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20},"sidebar":"tutorialSidebar","previous":{"title":"SDK for Java 2.x Kinesis","permalink":"/docs/aws/streaming/kinesis/examples/kinesis-sdk-java-2.1-examples"},"next":{"title":"SCS AWS Kinesis (LocalStack)","permalink":"/docs/aws/streaming/kinesis/examples/spring-cloud-stream-aws-kinesis"}}');var i=r(4848),s=r(8453);const a={sidebar_position:20},o="Spring Kinesis Producer",c={},l=[{value:"Kinesis Producer Library",id:"kinesis-producer-library",level:2},{value:"Introduction",id:"introduction",level:3},{value:"Example",id:"example",level:2},{value:"Create AWS Stream",id:"create-aws-stream",level:3},{value:"Spring Boot Project Structure",id:"spring-boot-project-structure",level:3},{value:"pom.xml",id:"pomxml",level:4},{value:"KplkinesislibraryApplication.java",id:"kplkinesislibraryapplicationjava",level:4},{value:"KplkinesislibraryConfig.java",id:"kplkinesislibraryconfigjava",level:4},{value:"Car.java",id:"carjava",level:4},{value:"Source Code",id:"source-code",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"spring-kinesis-producer",children:"Spring Kinesis Producer"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://github.com/awslabs/amazon-kinesis-producer?tab=readme-ov-file",children:"https://github.com/awslabs/amazon-kinesis-producer?tab=readme-ov-file"})})})}),"\n",(0,i.jsx)(n.h2,{id:"kinesis-producer-library",children:"Kinesis Producer Library"}),"\n",(0,i.jsx)(n.h3,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["The Amazon Kinesis Producer Library (KPL) performs many tasks common to creating efficient and reliable producers for ",(0,i.jsx)(n.a,{href:"http://aws.amazon.com/kinesis",children:(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"Amazon Kinesis"})})}),". By using the KPL, customers do not need to develop the same logic every time they create a new application for data ingestion."]}),"\n",(0,i.jsxs)(n.p,{children:["For detailed information and installation instructions, see the article ",(0,i.jsx)(n.a,{href:"http://docs.aws.amazon.com/kinesis/latest/dev/developing-producers-with-kpl.html",children:(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"Developing Producer Applications"})})})," for Amazon Kinesis Using the Amazon Kinesis Producer Library in the ",(0,i.jsx)(n.a,{href:"http://docs.aws.amazon.com/kinesis/latest/dev/introduction.html",children:(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"Amazon Kinesis Developer Guide"})})}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,i.jsx)(n.h3,{id:"create-aws-stream",children:"Create AWS Stream"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Go to the AWS console and search for Kinesis. Select the Kinesis Data Streams and click on the Create data Stream button."}),"\n",(0,i.jsxs)(n.li,{children:["Add a name for the Kinesis data stream:",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"aws-data-stream"})})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"spring-boot-project-structure",children:"Spring Boot Project Structure"}),"\n",(0,i.jsx)("img",{src:"/img/aws/kinesis/aws-kinesis-producer-proj-struct-01.png",alt:"aws-kinesis-producer-proj-struct-01.png"}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.h4,{id:"pomxml",children:"pom.xml"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n\txsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">\n\t<modelVersion>4.0.0</modelVersion>\n\t<parent>\n\t\t<groupId>org.springframework.boot</groupId>\n\t\t<artifactId>spring-boot-starter-parent</artifactId>\n\t\t<version>3.3.2</version>\n\t\t<relativePath/> \x3c!-- lookup parent from repository --\x3e\n\t</parent>\n\n\t<groupId>zjc.examples.kinesis</groupId>\n\t<artifactId>aws-kinesis-kplkinesislibrary</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>kplkinesislibrary</name>\n\n\t<description>AWS Kinesis Example project for Spring Boot</description>\n\n\t<properties>\n\t\t<java.version>21</java.version>\n\t</properties>\n\n\t<dependencies>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter</artifactId>\n\t\t</dependency>\n\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-test</artifactId>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\n\t\t<dependency>\n\t\t\t<groupId>com.amazonaws</groupId>\n\t\t\t<artifactId>amazon-kinesis-producer</artifactId>\n\t\t\t<version>0.15.10</version>\n\t\t</dependency>\n\n\t\t<dependency>\n\t\t\t<groupId>org.projectlombok</groupId>\n\t\t\t<artifactId>lombok</artifactId>\n\t\t\t<version>1.18.34</version>\n\t\t\t<scope>provided</scope>\n\t\t</dependency>\n\n\t\t<dependency>\n\t\t\t<groupId>jakarta.xml.bind</groupId>\n\t\t\t<artifactId>jakarta.xml.bind-api</artifactId>\n\t\t\t<version>4.0.2</version>\n\t\t</dependency>\n\n\t\t<dependency>\n\t\t\t<groupId>com.fasterxml.jackson.core</groupId>\n\t\t\t<artifactId>jackson-databind</artifactId>\n\t\t\t<version>2.17.2</version>\n\t\t</dependency>\n\n\t</dependencies>\n\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t\t<artifactId>spring-boot-maven-plugin</artifactId>\n\t\t\t</plugin>\n\t\t</plugins>\n\t</build>\n\n</project>\n'})}),"\n",(0,i.jsx)(n.h4,{id:"kplkinesislibraryapplicationjava",children:"KplkinesislibraryApplication.java"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package zjc.examples.kinesis.kplkinesislibrary;\n\nimport com.amazonaws.services.kinesis.producer.KinesisProducer;\nimport com.amazonaws.services.kinesis.producer.UserRecordResult;\nimport zjc.examples.kinesis.kplkinesislibrary.model.Car;\nimport com.fasterxml.jackson.core.JsonProcessingException;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.google.common.util.concurrent.FutureCallback;\nimport com.google.common.util.concurrent.Futures;\nimport com.google.common.util.concurrent.MoreExecutors;\nimport lombok.RequiredArgsConstructor;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.boot.CommandLineRunner;\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\nimport java.nio.ByteBuffer;\nimport java.nio.charset.StandardCharsets;\nimport java.util.UUID;\n\n@SpringBootApplication\n@RequiredArgsConstructor\npublic class KplkinesislibraryApplication implements CommandLineRunner {\n\tprivate static final Logger log = LoggerFactory.getLogger(KplkinesislibraryApplication.class);\n\n\tprivate final KinesisProducer kinesisProducer;\n\tprivate final ObjectMapper objectMapper;\n\tprivate final FutureCallback<UserRecordResult> futureCallback;\n\n    public static void main(String[] args) {\n\t\tSpringApplication.run(KplkinesislibraryApplication.class, args);\n\t}\n\n\t@Override\n\tpublic void run(String... args) throws Exception {\n\t\tString data;\n\t\ttry {\n\t\t\tdata = objectMapper.writeValueAsString(new Car(UUID.randomUUID().toString(), "Toyota"));\n\t\t} catch (JsonProcessingException e) {\n\t\t\tlog.info("Failed in convert object " + e.getMessage());\n\t\t\tthrow new RuntimeException(e);\n\t\t}\n\n\t\tvar resultListenableFuture = kinesisProducer.addUserRecord("aws-data-stream",\n\t\t\t\tUUID.randomUUID().toString(),\n\t\t\t\tByteBuffer.wrap(data.getBytes(StandardCharsets.UTF_8))\n\t\t\t\t);\n\n\t\tFutures.addCallback(resultListenableFuture, futureCallback, MoreExecutors.directExecutor());\n\t\tkinesisProducer.flushSync();\n\t\tSystem.out.println("finish sending log to kinesis");\n\t}\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"kplkinesislibraryconfigjava",children:"KplkinesislibraryConfig.java"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package zjc.examples.kinesis.kplkinesislibrary;\n\nimport com.amazonaws.auth.AWSStaticCredentialsProvider;\nimport com.amazonaws.auth.BasicAWSCredentials;\nimport com.amazonaws.services.kinesis.producer.KinesisProducer;\nimport com.amazonaws.services.kinesis.producer.KinesisProducerConfiguration;\nimport com.amazonaws.services.kinesis.producer.UserRecordResult;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.google.common.util.concurrent.FutureCallback;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\npublic class KplkinesislibraryConfig {\n    private static final Logger log = LoggerFactory.getLogger(KplkinesislibraryConfig.class);\n\n    @Bean\n    public KinesisProducer kinesisProducer() {\n        return new KinesisProducer(kinesisProducerConfiguration());\n    }\n\n    @Bean\n    public KinesisProducerConfiguration kinesisProducerConfiguration() {\n//        String accessKey = System.getenv("AWS_ACCESS_KEY_ID");\n//        String secretKey = System.getenv("AWS_SECRET_ACCESS_KEY");\n//        String region = System.getenv("region");\n\n        String accessKey = "************";\n        String secretKey = "*******************************";\n        String region = "us-east-1";\n\n        BasicAWSCredentials awsCredentials = new BasicAWSCredentials(accessKey, secretKey);\n\n        return new KinesisProducerConfiguration()\n                .setCredentialsProvider(new AWSStaticCredentialsProvider(awsCredentials))\n                .setVerifyCertificate(false)\n                .setMaxConnections(1)\n                .setRegion(region)\n                .setRecordTtl(3000);\n    }\n\n    @Bean\n    public ObjectMapper objectMapper() {\n        return new ObjectMapper();\n    }\n\n    @Bean\n    public FutureCallback<UserRecordResult> futureCallback() {\n        return new FutureCallback<>() {\n            @Override\n            public void onFailure(Throwable t) {\n                log.error(t.getMessage());\n            }\n\n            @Override\n            public void onSuccess(UserRecordResult result) {\n                log.info(result.getShardId() + " sequence number " + result.getSequenceNumber());\n            }\n        };\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"carjava",children:"Car.java"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"package zjc.examples.kinesis.kplkinesislibrary.model;\n\npublic record Car(String id, String name) {\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"source-code",children:"Source Code"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://github.com/ZbCiok/zjc-examples/tree/main/aws/aws/aws-kinesis-kplkinesislibrary",children:"https://github.com/ZbCiok/zjc-examples/tree/main/aws/aws/aws-kinesis-kplkinesislibrary"})})})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var t=r(6540);const i={},s=t.createContext(i);function a(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);