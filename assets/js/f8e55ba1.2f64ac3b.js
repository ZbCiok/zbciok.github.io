"use strict";(self.webpackChunkjreact_com_docsaurus_01=self.webpackChunkjreact_com_docsaurus_01||[]).push([[9460],{4538:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"messaging/rabbitmq/examples/direct-exchange-in-amqp","title":"Direct Exchange in AMQP","description":"Description","source":"@site/docs/messaging/rabbitmq/examples/direct-exchange-in-amqp.mdx","sourceDirName":"messaging/rabbitmq/examples","slug":"/messaging/rabbitmq/examples/direct-exchange-in-amqp","permalink":"/docs/messaging/rabbitmq/examples/direct-exchange-in-amqp","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":200,"frontMatter":{"sidebar_position":200},"sidebar":"tutorialSidebar","previous":{"title":"Hello World","permalink":"/docs/messaging/rabbitmq/examples/hello-world"},"next":{"title":"Topic Exchange in AMQP","permalink":"/docs/messaging/rabbitmq/examples/topic-exchange-in-amqp"}}');var i=t(4848),c=t(8453);const r={sidebar_position:200},o="Direct Exchange in AMQP",s={},l=[{value:"Description",id:"description",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Install RabbitMQ on Docker",id:"install-rabbitmq-on-docker",level:2},{value:"docker-compose.yml:",id:"docker-composeyml",level:4},{value:"Project Structure",id:"project-structure",level:2},{value:"pom.xml",id:"pomxml",level:3},{value:"CommonConfigs.java",id:"commonconfigsjava",level:3},{value:"ConnectionManager.java",id:"connectionmanagerjava",level:3},{value:"DirectExchange.java",id:"directexchangejava",level:3},{value:"Run",id:"run",level:2},{value:"Output",id:"output",level:3}];function m(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"direct-exchange-in-amqp",children:"Direct Exchange in AMQP"})}),"\n",(0,i.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,i.jsx)("img",{src:"/img/messaging/rabbitmq/rabbitmq-exchange-01.png",alt:"rabbitmq-exchange-01.png"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A Producer sends a message to an Exchange."}),"\n",(0,i.jsx)(n.li,{children:"A Queue binds to an Exchange using a routing key."}),"\n",(0,i.jsx)(n.li,{children:"Usually, there is more than one Queue bind to an Exchange using the same/different routing keys."}),"\n",(0,i.jsx)(n.li,{children:"The message sent to the Exchange contains a routing key. Based on the routing key the message is forwarded to one or more Queues."}),"\n",(0,i.jsx)(n.li,{children:"Consumers subscribe to the Queue receives the message and processes it."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"JDK 17+"}),"\n",(0,i.jsx)(n.li,{children:"RabbitMQ on Docker"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"install-rabbitmq-on-docker",children:"Install RabbitMQ on Docker"}),"\n",(0,i.jsx)(n.h4,{id:"docker-composeyml",children:"docker-compose.yml:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'version: "3.6"\n# https://docs.docker.com/compose/compose-file/\n\nservices:\n  rabbitmq:\n    image: \'rabbitmq:3.6-management-alpine\'\n    ports:\n      # The standard AMQP protocol port\n      - \'5672:5672\'\n      # HTTP management UI\n      - \'15672:15672\'\n    environment:\n      # The location of the RabbitMQ server.  "amqp" is the protocol;\n      # "rabbitmq" is the hostname.  Note that there is not a guarantee\n      # that the server will start first!  Telling the pika client library\n      # to try multiple times gets around this ordering issue.\n      AMQP_URL: \'amqp://rabbitmq?connection_attempts=5&retry_delay=5\'\n      RABBITMQ_DEFAULT_USER: "guest"\n      RABBITMQ_DEFAULT_PASS: "guest"\n    networks:\n      - network\n#    volumes:\n#      - ./.docker/rabbitmq/etc/:/etc/rabbitmq/\n#      - ./.docker/rabbitmq/data/:/var/lib/rabbitmq/\n#      - ./.docker/rabbitmq/logs/:/var/log/rabbitmq/\n\nnetworks:\n  # Declare our private network.  We must declare one for the magic\n  # Docker DNS to work, but otherwise its default settings are fine.\n  network: {}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"http://localhost:15672/\n"})}),"\n",(0,i.jsx)(n.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:".\n\u251c\u2500\u2500 pom.xml\n\u251c\u2500\u2500 rabbitmq-docker\n\u2502\xa0\xa0 \u2514\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 readme.md\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 main\n        \u2514\u2500\u2500 java\n            \u2514\u2500\u2500 com\n                \u2514\u2500\u2500 amqp\n                    \u251c\u2500\u2500 basic\n                    \u2502\xa0\xa0 \u2514\u2500\u2500 queue\n                    \u2502\xa0\xa0     \u2514\u2500\u2500 CommonConfigs.java\n                    \u2514\u2500\u2500 exchanges\n                        \u251c\u2500\u2500 ConnectionManager.java\n                        \u2514\u2500\u2500 DirectExchange.java\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pomxml",children:"pom.xml"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n\n  <modelVersion>4.0.0</modelVersion>\n\n  <groupId>rabbitmq-examples</groupId>\n  <artifactId>rabbitmq-direct-exchange</artifactId>\n  <version>0.0.1-SNAPSHOT</version>\n  <description>RabbitMQ code examples using the amqp-client</description>\n\n  <properties>\n    <maven.compiler.target>22</maven.compiler.target>\n    <maven.compiler.source>22</maven.compiler.source>\n    <java.version>22</java.version>\n  </properties>\n\n  <dependencies>\n    <dependency>\n      <groupId>com.rabbitmq</groupId>\n      <artifactId>amqp-client</artifactId>\n      <version>5.24.0</version>\n    </dependency>\n  </dependencies>\n\n</project>\n'})}),"\n",(0,i.jsx)(n.h3,{id:"commonconfigsjava",children:"CommonConfigs.java"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.amqp.basic.queue;\n\npublic class CommonConfigs {\n  public static final String DEFAULT_QUEUE = "Queue-1";\n  public static final String AMQP_URL = "amqp://guest:guest@localhost:5672/";\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"connectionmanagerjava",children:"ConnectionManager.java"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.amqp.exchanges;\n\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\npublic class ConnectionManager {\n\n  private static Connection connection = null;\n\n  /**\n   * Create RabbitMQ Connection\n   *\n   * @return Connection\n   */\n  public static Connection getConnection() {\n    if (connection == null) {\n      try {\n        ConnectionFactory connectionFactory = new ConnectionFactory();\n        connection = connectionFactory.newConnection("amqp://guest:guest@localhost:5672/");\n      } catch (IOException | TimeoutException e) {\n        e.printStackTrace();\n      }\n    }\n    return connection;\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"directexchangejava",children:"DirectExchange.java"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.amqp.exchanges;\n\nimport com.rabbitmq.client.*;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * Selective message broadcast with routingkey filter.\n */\npublic class DirectExchange {\n\n  //Declare the exchange\n  public static void declareExchange() throws IOException, TimeoutException {\n    Channel channel = ConnectionManager.getConnection().createChannel();\n    //Declare my-direct-exchange DIRECT exchange\n    channel.exchangeDeclare("my-direct-exchange", BuiltinExchangeType.DIRECT, true);\n    channel.close();\n  }\n\n  //Declare the Queues\n  public static void declareQueues() throws IOException, TimeoutException {\n    //Create a channel - do not share the Channel instance\n    Channel channel = ConnectionManager.getConnection().createChannel();\n\n    //Create the Queues\n    channel.queueDeclare("MobileQ", true, false, false, null);\n    channel.queueDeclare("ACQ", true, false, false, null);\n    channel.queueDeclare("LightQ", true, false, false, null);\n\n    channel.close();\n  }\n\n  //Create the Bindings\n  public static void declareBindings() throws IOException, TimeoutException {\n    Channel channel = ConnectionManager.getConnection().createChannel();\n    //Create bindings - (queue, exchange, routingKey)\n    channel.queueBind("MobileQ", "my-direct-exchange", "personalDevice");\n    channel.queueBind("ACQ", "my-direct-exchange", "homeAppliance");\n    channel.queueBind("LightQ", "my-direct-exchange", "homeAppliance");\n    channel.close();\n  }\n\n  //Create the Subscribers\n  public static void subscribeMessage() throws IOException {\n    Channel channel = ConnectionManager.getConnection().createChannel();\n    channel.basicConsume("LightQ", true, ((consumerTag, message) -> {\n      System.out.println(consumerTag);\n      System.out.println("LightQ:" + new String(message.getBody()));\n    }), consumerTag -> {\n      System.out.println(consumerTag);\n    });\n\n    channel.basicConsume("ACQ", true, ((consumerTag, message) -> {\n      System.out.println(consumerTag);\n      System.out.println("ACQ:" + new String(message.getBody()));\n    }), consumerTag -> {\n      System.out.println(consumerTag);\n    });\n\n    channel.basicConsume("MobileQ", true, ((consumerTag, message) -> {\n      System.out.println(consumerTag);\n      System.out.println("MobileQ:" + new String(message.getBody()));\n    }), consumerTag -> {\n      System.out.println(consumerTag);\n    });\n  }\n\n  //Publish the messages\n  public static void publishMessage() throws IOException, TimeoutException {\n    Channel channel = ConnectionManager.getConnection().createChannel();\n    String message = "Direct message - Turn on the Home Appliances ";\n    channel.basicPublish("my-direct-exchange", "homeAppliance", null, message.getBytes());\n    channel.close();\n  }\n\n  public static void main(String[] args) throws IOException, TimeoutException {\n    DirectExchange.declareQueues();\n    DirectExchange.declareExchange();\n    DirectExchange.declareBindings();\n\n    //Threads created to publish-subscribe asynchronously\n    Thread subscribe = new Thread(){\n      @Override\n      public void run() {\n        try {\n          DirectExchange.subscribeMessage();\n        } catch (IOException e) {\n          e.printStackTrace();\n        }\n      }\n    };\n\n    Thread publish = new Thread(){\n      @Override\n      public void run() {\n        try {\n          DirectExchange.publishMessage();\n        } catch (IOException | TimeoutException e) {\n          e.printStackTrace();\n        }\n      }\n    };\n\n    subscribe.start();\n    publish.start();\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"run",children:"Run"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public static void main(String[] args) throws IOException, TimeoutException { ...\n"})}),"\n",(0,i.jsx)(n.h3,{id:"output",children:"Output"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"amq.ctag-blalUvgtHM6x9NgjQA9mEg\nLightQ:Direct message - Turn on the Home Appliances\namq.ctag-Fuoi24ca2qGAALCs5geDpQ\nACQ:Direct message - Turn on the Home Appliances\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Source"})," Code: ",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://github.com/ZbCiok/zjc-examples/tree/main/reactive-messaging/rabbitmq/rabbitmq-direct-exchange",children:"https://github.com/ZbCiok/zjc-examples/tree/main/reactive-messaging/rabbitmq/rabbitmq-direct-exchange"})})})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Based on:"})," ",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://jstobigdata.com/rabbitmq/direct-exchange-in-amqp-rabbitmq/",children:"https://jstobigdata.com/rabbitmq/direct-exchange-in-amqp-rabbitmq/"})})})," ",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://github.com/jstobigdata/rabbitmq-parent-project/blob/master/00-getting-started/src/main/java/com/amqp/exchanges/all/DirectExchange.java",children:"https://github.com/jstobigdata/rabbitmq-parent-project/blob/master/00-getting-started/src/main/java/com/amqp/exchanges/all/DirectExchange.java"})})})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(m,{...e})}):m(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var a=t(6540);const i={},c=a.createContext(i);function r(e){const n=a.useContext(c);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(c.Provider,{value:n},e.children)}}}]);