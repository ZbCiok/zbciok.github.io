"use strict";(self.webpackChunkjreact_com_docsaurus_01=self.webpackChunkjreact_com_docsaurus_01||[]).push([[1851],{6538:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>s,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>l});var t=a(4848),i=a(8453);const o={sidebar_position:230},c="Fanout Exchange in AMQP",r={id:"messaging/rabbitmq/examples/fanout-exchange-in-amqp",title:"Fanout Exchange in AMQP",description:"Description",source:"@site/docs/messaging/rabbitmq/examples/fanout-exchange-in-amqp.mdx",sourceDirName:"messaging/rabbitmq/examples",slug:"/messaging/rabbitmq/examples/fanout-exchange-in-amqp",permalink:"/docs/messaging/rabbitmq/examples/fanout-exchange-in-amqp",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:230,frontMatter:{sidebar_position:230},sidebar:"tutorialSidebar",previous:{title:"Headers Exchange in AMQP",permalink:"/docs/messaging/rabbitmq/examples/headers-exchange-in-amqp"},next:{title:"References",permalink:"/docs/messaging/rabbitmq/references"}},s={},l=[{value:"Description",id:"description",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Install RabbitMQ on Docker",id:"install-rabbitmq-on-docker",level:2},{value:"docker-compose.yml:",id:"docker-composeyml",level:4},{value:"Project Structure",id:"project-structure",level:2},{value:"pom.xml",id:"pomxml",level:3},{value:"CommonConfigs.java",id:"commonconfigsjava",level:3},{value:"ConnectionManager.java",id:"connectionmanagerjava",level:3},{value:"FanoutExchange.java",id:"fanoutexchangejava",level:3},{value:"Run",id:"run",level:2},{value:"Output",id:"output",level:3}];function m(n){const e={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"fanout-exchange-in-amqp",children:"Fanout Exchange in AMQP"})}),"\n",(0,t.jsx)(e.h2,{id:"description",children:"Description"}),"\n",(0,t.jsx)("img",{src:"/img/messaging/rabbitmq/rabbitmq-fanout-excange-diagr-01.png",width:"200 px",alt:"rabbitmq-fanout-excange-diagr-01.png"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"One or more Queues bind to the Fanout exchange with no routing keys."}),"\n",(0,t.jsx)(e.li,{children:"A publisher sends the Exchange a message."}),"\n",(0,t.jsx)(e.li,{children:"The Exchange then forwards the message to the Queues unconditionally."}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"requirements",children:"Requirements"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"JDK 17+"}),"\n",(0,t.jsx)(e.li,{children:"RabbitMQ on Docker"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"install-rabbitmq-on-docker",children:"Install RabbitMQ on Docker"}),"\n",(0,t.jsx)(e.h4,{id:"docker-composeyml",children:"docker-compose.yml:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'version: "3.6"\n# https://docs.docker.com/compose/compose-file/\n\nservices:\n  rabbitmq:\n    image: \'rabbitmq:3.6-management-alpine\'\n    ports:\n      # The standard AMQP protocol port\n      - \'5672:5672\'\n      # HTTP management UI\n      - \'15672:15672\'\n    environment:\n      # The location of the RabbitMQ server.  "amqp" is the protocol;\n      # "rabbitmq" is the hostname.  Note that there is not a guarantee\n      # that the server will start first!  Telling the pika client library\n      # to try multiple times gets around this ordering issue.\n      AMQP_URL: \'amqp://rabbitmq?connection_attempts=5&retry_delay=5\'\n      RABBITMQ_DEFAULT_USER: "guest"\n      RABBITMQ_DEFAULT_PASS: "guest"\n    networks:\n      - network\n#    volumes:\n#      - ./.docker/rabbitmq/etc/:/etc/rabbitmq/\n#      - ./.docker/rabbitmq/data/:/var/lib/rabbitmq/\n#      - ./.docker/rabbitmq/logs/:/var/log/rabbitmq/\n\nnetworks:\n  # Declare our private network.  We must declare one for the magic\n  # Docker DNS to work, but otherwise its default settings are fine.\n  network: {}\n'})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"http://localhost:15672/\n"})}),"\n",(0,t.jsx)(e.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:".\n\u251c\u2500\u2500 pom.xml\n\u251c\u2500\u2500 rabbitmq-docker\n\u2502\xa0\xa0 \u2514\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 readme.md\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 main\n        \u2514\u2500\u2500 java\n            \u2514\u2500\u2500 com\n                \u2514\u2500\u2500 amqp\n                    \u251c\u2500\u2500 basic\n                    \u2502\xa0\xa0 \u2514\u2500\u2500 queue\n                    \u2502\xa0\xa0     \u2514\u2500\u2500 CommonConfigs.java\n                    \u2514\u2500\u2500 exchanges\n                        \u251c\u2500\u2500 ConnectionManager.java\n                        \u2514\u2500\u2500 FanoutExchange.java\n"})}),"\n",(0,t.jsx)(e.h3,{id:"pomxml",children:"pom.xml"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n\n  <modelVersion>4.0.0</modelVersion>\n\n  <groupId>rabbitmq-examples</groupId>\n  <artifactId>rabbitmq-fanout-exchange</artifactId>\n  <version>0.0.1-SNAPSHOT</version>\n  <description>RabbitMQ code examples using the amqp-client</description>\n\n  <properties>\n    <maven.compiler.target>22</maven.compiler.target>\n    <maven.compiler.source>22</maven.compiler.source>\n    <java.version>22</java.version>\n  </properties>\n\n  <dependencies>\n    <dependency>\n      <groupId>com.rabbitmq</groupId>\n      <artifactId>amqp-client</artifactId>\n      <version>5.24.0</version>\n    </dependency>\n  </dependencies>\n\n</project>\n'})}),"\n",(0,t.jsx)(e.h3,{id:"commonconfigsjava",children:"CommonConfigs.java"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'package com.amqp.basic.queue;\n\npublic class CommonConfigs {\n  public static final String DEFAULT_QUEUE = "Queue-1";\n  public static final String AMQP_URL = "amqp://guest:guest@localhost:5672/";\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"connectionmanagerjava",children:"ConnectionManager.java"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'package com.amqp.exchanges;\n\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\npublic class ConnectionManager {\n\n  private static Connection connection = null;\n\n  /**\n   * Create RabbitMQ Connection\n   *\n   * @return Connection\n   */\n  public static Connection getConnection() {\n    if (connection == null) {\n      try {\n        ConnectionFactory connectionFactory = new ConnectionFactory();\n        connection = connectionFactory.newConnection("amqp://guest:guest@localhost:5672/");\n      } catch (IOException | TimeoutException e) {\n        e.printStackTrace();\n      }\n    }\n    return connection;\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"fanoutexchangejava",children:"FanoutExchange.java"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'package com.amqp.exchanges;\n\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * Unconditional message broadcast.\n */\npublic class FanoutExchange {\n\n  public static void declareExchange() throws IOException, TimeoutException {\n    Channel channel = ConnectionManager.getConnection().createChannel();\n    //Declare my-fanout-exchange\n    channel.exchangeDeclare("my-fanout-exchange", BuiltinExchangeType.FANOUT, true);\n    channel.close();\n  }\n\n  public static void declareQueues() throws IOException, TimeoutException {\n    //Create a channel - do not share the Channel instance\n    Channel channel = ConnectionManager.getConnection().createChannel();\n\n    //Create the Queues\n    channel.queueDeclare("MobileQ", true, false, false, null);\n    channel.queueDeclare("ACQ", true, false, false, null);\n    channel.queueDeclare("LightQ", true, false, false, null);\n\n    channel.close();\n  }\n\n  public static void declareBindings() throws IOException, TimeoutException {\n    Channel channel = ConnectionManager.getConnection().createChannel();\n    //Create bindings - (queue, exchange, routingKey) - routingKey != null\n    channel.queueBind("MobileQ", "my-fanout-exchange", "");\n    channel.queueBind("ACQ", "my-fanout-exchange", "");\n    channel.queueBind("LightQ", "my-fanout-exchange", "");\n    channel.close();\n  }\n\n  public static void subscribeMessage() throws IOException, TimeoutException {\n    Channel channel = ConnectionManager.getConnection().createChannel();\n    channel.basicConsume("LightQ", true, ((consumerTag, message) -> {\n      System.out.println(consumerTag);\n      System.out.println("LightQ: " + new String(message.getBody()));\n    }), consumerTag -> {\n      System.out.println(consumerTag);\n    });\n\n    channel.basicConsume("ACQ", true, ((consumerTag, message) -> {\n      System.out.println(consumerTag);\n      System.out.println("ACQ: " + new String(message.getBody()));\n    }), consumerTag -> {\n      System.out.println(consumerTag);\n    });\n\n    channel.basicConsume("MobileQ", true, ((consumerTag, message) -> {\n      System.out.println(consumerTag);\n      System.out.println("MobileQ: " + new String(message.getBody()));\n    }), consumerTag -> {\n      System.out.println(consumerTag);\n    });\n  }\n\n  public static void publishMessage() throws IOException, TimeoutException {\n    Channel channel = ConnectionManager.getConnection().createChannel();\n    String message = "Main Power is ON";\n    channel.basicPublish("my-fanout-exchange", "", null, message.getBytes());\n    channel.close();\n  }\n\n  public static void main(String[] args) throws IOException, TimeoutException {\n    FanoutExchange.declareQueues();\n    FanoutExchange.declareExchange();\n    FanoutExchange.declareBindings();\n\n    //Threads created to publish-subscribe asynchronously\n    Thread subscribe = new Thread() {\n      @Override\n      public void run() {\n        try {\n          FanoutExchange.subscribeMessage();\n        } catch (IOException | TimeoutException e) {\n          e.printStackTrace();\n        }\n      }\n    };\n\n    Thread publish = new Thread() {\n      @Override\n      public void run() {\n        try {\n          FanoutExchange.publishMessage();\n        } catch (IOException | TimeoutException e) {\n          e.printStackTrace();\n        }\n      }\n    };\n\n    subscribe.start();\n    publish.start();\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"run",children:"Run"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"public static void main(String[] args) throws IOException, TimeoutException { ...\n"})}),"\n",(0,t.jsx)(e.h3,{id:"output",children:"Output"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"amq.ctag-m8cjdQniE8tXYQjHw44f7Q\nLightQ: Main Power is ON\namq.ctag-1rsJPVZkXgwMBvTBEJQJ6w\nACQ: Main Power is ON\namq.ctag-6X_dOQzw7rjiPOUQDK1bfg\nMobileQ: Main Power is ON\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Source Code:"})," ",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(e.em,{children:(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.a,{href:"https://github.com/ZbCiok/zjc-examples/tree/main/reactive-messaging/rabbitmq/rabbitmq-fanout-exchange",children:"https://github.com/ZbCiok/zjc-examples/tree/main/reactive-messaging/rabbitmq/rabbitmq-fanout-exchange"})})})]})]})}function u(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(m,{...n})}):m(n)}},8453:(n,e,a)=>{a.d(e,{R:()=>c,x:()=>r});var t=a(6540);const i={},o=t.createContext(i);function c(n){const e=t.useContext(o);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:c(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);